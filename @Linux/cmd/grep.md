##### Grep ip
`ifconfig tun0 | awk -F' ' '{print $2}'|  grep -E -o '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]'`
```shell-session
SysRq@htb[/htb]$ cat /etc/passwd | grep -v "false\|nologin"

root:x:0:0:root:/root:/bin/bash
sync:x:4:65534:sync:/bin:/bin/sync
postgres:x:111:117:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
user6:x:1000:1000:,,,:/home/user6:/bin/bash
```

```shell-session
SysRq@htb[/htb]$ cat /etc/passwd | grep "/bin/bash"

root:x:0:0:root:/root:/bin/bash
mrb3n:x:1000:1000:mrb3n:/home/mrb3n:/bin/bash
cry0l1t3:x:1001:1001::/home/cry0l1t3:/bin/bash
htb-student:x:1002:1002::/home/htb-student:/bin/bash
```

СИНТАКСИС GREP  
Синтаксис команды выглядит следующим образом:  
  
$ grep [опции] шаблон [имя файла...]  
  
Или:  
  
$ команда | grep [опции] шаблон  
  
Опции - это дополнительные параметры, с помощью которых указываются различные настройки поиска и вывода, например количество строк или режим инверсии.  
Шаблон - это любая строка или регулярное выражение, по которому будет вестись поиск  
Файл и команда - это то место, где будет вестись поиск. Как вы увидите дальше, grep позволяет искать в нескольких файлах и даже в каталоге, используя рекурсивный режим.  
Возможность фильтровать стандартный вывод пригодится,например, когда нужно выбрать только ошибки из логов или найти PID процесса в многочисленном отчёте утилиты ps.  
  
ОПЦИИ  
Давайте рассмотрим самые основные опции утилиты, которые помогут более эффективно выполнять поиск текста в файлах grep:  
  
-b - показывать номер блока перед строкой;  
-c - подсчитать количество вхождений шаблона;  
-h - не выводить имя файла в результатах поиска внутри файлов Linux;  
-i - не учитывать регистр;  
- l - отобразить только имена файлов, в которых найден шаблон;  
-n - показывать номер строки в файле;  
-s - не показывать сообщения об ошибках;  
-v - инвертировать поиск, выдавать все строки кроме тех, что содержат шаблон;  
-w - искать шаблон как слово, окружённое пробелами;  
-e - использовать регулярные выражения при поиске;  
-An - показать вхождение и n строк до него;  
-Bn - показать вхождение и n строк после него;  
-Cn - показать n строк до и после вхождения;  
Все самые основные опции рассмотрели и даже больше, теперь перейдём к примерам работы команды grep Linux.  
  
ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ  
С теорией покончено, теперь перейдём к практике. Рассмотрим несколько основных примеров поиска внутри файлов Linux с помощью grep, которые могут вам понадобиться в повседневной жизни.  
  
ПОИСК ТЕКСТА В ФАЙЛАХ  
В первом примере мы будем искать пользователя User в файле паролей Linux. Чтобы выполнить поиск текста grep в файле /etc/passwd введите следующую команду:  
  
 grep User /etc/passwd  
  
В результате вы получите что-то вроде этого, если, конечно, существует такой пользователь:  
  
User:x:1000:1000:User,,,:/home/User:/bin/bash  
  
А теперь не будем учитывать регистр во время поиска. Тогда комбинации ABC, abc и Abc с точки зрения программы будут одинаковы:  
  
 grep -i "user" /etc/passwd  
  
ВЫВЕСТИ НЕСКОЛЬКО СТРОК  
Например, мы хотим выбрать все ошибки из лог-файла, но знаем, что в следующей строчке после ошибки может содержаться полезная информация, тогда с помощью grep отобразим несколько строк. Ошибки будем искать в Xorg.log по шаблону "EE":  
  
 grep -A4 "EE" /var/log/xorg.0.log  
  
Выведет строку с вхождением и 4 строчки после неё:  
  
 grep -B4 "EE" /var/log/xorg.0.log  
  
Выведет целевую строку и 4 строчки до неё:  
  
 grep -C2 "EE" /var/log/xorg.0.log  
  
Выведет по две строки с верху и снизу от вхождения.  
  
РЕГУЛЯРНЫЕ ВЫРАЖЕНИЯ В GREP  
Регулярные выражения grep - очень мощный инструмент в разы расширяющий возможности поиска текста в файлах. Для активации этого режима используйте опцию -e. Рассмотрим несколько примеров:  
  
Поиск вхождения в начале строки с помощью спецсимвола "^", например, выведем все сообщения за ноябрь:  
  
 grep "^Nov 10" messages.1  
  
Nov 10 01:12:55 gs123 ntpd[2241]: time reset +0.177479 s  
Nov 10 01:17:17 gs123 ntpd[2241]: synchronized to LOCAL(0), stratum 10  
  
Поиск в конце строки - спецсимвол "$":  
  
 grep "terminating.$" messages  
  
Jul 12 17:01:09 cloneme kernel: Kernel log daemon terminating.  
Oct 28 06:29:54 cloneme kernel: Kernel log daemon terminating.  
  
Найдём все строки, которые содержат цифры:  
  
 grep "[0-9]" /var/log/Xorg.0.log  
  
Вообще, регулярные выражения grep - это очень обширная тема, в этой статье я лишь показал несколько примеров. Как вы увидели, поиск текста в файлах grep становиться ещё эффективнее. Но на полное объяснение этой темы нужна целая статья, поэтому пока пропустим её и пойдем дальше.  
  
РЕКУРСИВНОЕ ИСПОЛЬЗОВАНИЕ GREP  
Если вам нужно провести поиск текста в нескольких файлах, размещённых в одном каталоге или подкаталогах, например в файлах конфигурации Apache - /etc/apache2/, используйте рекурсивный поиск. Для включения рекурсивного поиска в grep есть опция -r. Следующая команда займётся поиском текста в файлах Linux во всех подкаталогах /etc/apache2 на предмет вхождения строки mydomain.com:  
  
 grep -r "mydomain.com" /etc/apache2/  
  
В выводе вы получите:  
  
 grep -r "zendsite" /etc/apache2/  
/etc/apache2/vhosts.d/zendsite_vhost.conf: ServerName zendsite.localhost  
/etc/apache2/vhosts.d/zendsite_vhost.conf: DocumentRoot /var/www/localhost/htdocs/zendsite  
/etc/apache2/vhosts.d/zendsite_vhost.conf: <Directory /var/www/localhost/htdocs/zendsite>  
  
Здесь перед найденной строкой указано имя файла, в котором она была найдена. Вывод имени файла легко отключить с помощью опции -h:  
  
 grep -h -r "zendsite" /etc/apache2/  
  
ServerName zendsite.localhost  
DocumentRoot /var/www/localhost/htdocs/zendsite  
<Directory /var/www/localhost/htdocs/zendsite>  
  
ПОИСК СЛОВ В GREP  
Когда вы ищете строку abc, grep будет выводить также kbabc, abc123, aafrabc32 и тому подобные комбинации. Вы можете заставить утилиту искать по содержимому файлов в Linux только те строки, которые выключают искомые слова с помощью опции -w:  
  
grep -w "abc" имя_файла  
  
ПОИСК ДВУХ СЛОВ  
Можно искать по содержимому файла не одно слово, а два сразу:  
  
 egrep -w 'word1|word2' /path/to/file  
  
КОЛИЧЕСТВО ВХОЖДЕНИЙ СТРОКИ  
Утилита grep может сообщить, сколько раз определённая строка была найдена в каждом файле. Для этого используется опция -c (счетчик):  
  
 grep -c 'word' /path/to/file  
  
C помощью опции -n можно выводить номер строки, в которой найдено вхождение, например:  
  
 grep -n 'root' /etc/passwd  
  
Получим:  
  
1:root:x:0:0:root:/root:/bin/bash  
  
ИНВЕРТИРОВАННЫЙ ПОИСК В GREP  
Команда grep Linux может быть использована для поиска строк в файле, которые не содержат указанное слово. Например, вывести только те строки, которые не содержат слово пар:  
  
 grep -v пар /path/to/file  
  
ВЫВОД ИМЕНИ ФАЙЛА  
Вы можете указать grep выводить только имя файла, в котором было найдено заданное слово с помощью опции -l. Например, следующая команда выведет все имена файлов, при поиске по содержимому которых было обнаружено вхождение primary:  
  
 grep -l 'primary' *.c  
  
ЦВЕТНОЙ ВЫВОД В GREP  
Также вы можете заставить программу выделять другим цветом вхождения в выводе:  
  
 grep --color root /etc/passwd